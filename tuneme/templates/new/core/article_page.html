{% extends "base.html" %}
{% load wagtailcore_tags wagtailimages_tags comments mptt_tags molo_commenting_tags static poll_votings i18n %}
{% block content %}

<div class="breadcrumbs">
  <a href="{{request.site.root_page.url}}">{% trans "Home" %}</a>
  <a href="{% pageurl self.get_parent_section %}">{{self.get_parent_section.title}}</a>
  {{ self.title }}
</div>

{% if self.image %}
  {% image self.image width-280 as article_image %}
  <div class="article__image">
    <img src="{{ article_image.url }}" />
  </div>
{% endif %}

<h1 class="article__title">{{ self.title }}</h1>
<h2 class="article__subtitle">{{ self.subtitle }}</h2>

<div class="article__content article__content{{ self.get_parent_section.get_effective_extra_style_hints }}">
  {% for block in self.body %}
    {% if block.block_type == 'heading' %}
        <h4>{{ block.value }}</h4>
    {% elif block.block_type == 'image' %}
      {% image block.value width-280 as article_image %}
      <div class="article__image">
        <img src="{{ article_image.url }}" />
      </div>
    {% elif block.block_type == 'numbered_list' %}
         <ol>
         {% for item in block.value %}
           <li>{{item}}</li>
         {% endfor %}
         </ol>
    {% else %}
        {{ block }}
    {% endif %}
  {% endfor %}
</div>


{% has_questions self as questions %}
{% if questions %}
  <div class="article__polls">
    {% poll_page_in_section page=self %}
  </div>
{% endif %}

{% if self.is_commenting_enabled %}
  <div class="heading heading--article heading--comments heading{{ self.get_parent_section.get_effective_extra_style_hints }}">{% trans "Comment" %}</div>
  <div id="comments-list" class="comments-list comments-list{{ self.get_parent_section.get_effective_extra_style_hints }}">
  {% get_comment_count for self as comment_count %}
  {% get_molo_comments for self as comment_list %}
    {% for node in comment_list %}
      {% recursetree node %}
        {% include "comments/comment.html" %}
          {{ children }}
      {% endrecursetree %}
    {% endfor %}
  {% if comment_count > 5 %}
    <div class="comments-list__pagination">
      <a href="{% url 'more-comments' self.pk %}">{% trans "More" %}</a>
    </div>
  {% endif %}
  {% if self.allow_commenting %}
    {% if request.user.is_authenticated %}
      {% render_comment_form for self %}
    {% else %}
      <div class="auth-call-to-action">
        <a href="{% url 'molo.profiles:auth_login' %}?next={{request.path}}#comments-list">{% trans "Log in" %}</a>
        {% trans "or" %}
        <a href="{% url 'molo.profiles:user_register' %}?next={{request.path}}#comments-list">{% trans "Register" %}</a>
        {% trans "to comment" %}
      </div>
    {% endif %}
  {% else %}
    <p class="comments-list__disabled">{% trans "Commenting on this article is currently disabled" %}</p>
  {% endif %}
</div>
{% endif %}

{% endblock %}
